<!-- <!DOCTYPE html>
<html>
<head>
    <title>MQTT Client</title>
</head>
<body>
    <h1>MQTT Client</h1>
    <button id="connect">Connect</button>
    <button id="publish">Publish</button>
    <input type="text" id="message" placeholder="Enter message">
    <div id="log"></div>
    <div id="mqttData"></div> ที่แสดงผลข้อมูลจาก MQTT -->

    <!-- โหลดไฟล์ Paho MQTT Client จาก CDN -->
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
    <script>
        const client = new Paho.MQTT.Client("broker.hivemq.com", 8000, "999");

        client.onConnectionLost = function (responseObject) {
            console.log("Connection lost: " + responseObject.errorMessage);
        };

        client.onMessageArrived = function (message) {
            console.log("Message arrived: " + message.payloadString);
            document.getElementById("mqttData").innerHTML += "<p>" + message.payloadString + "</p>";
        };

        document.getElementById("connect").onclick = function () {
            client.connect({
                onSuccess: onConnect,
                userName: "",
                password: ""
            });
        };

        document.getElementById("publish").onclick = function () {
            var message = new Paho.MQTT.Message(document.getElementById("message").value);
            message.destinationName = "testtopic/999157";
            client.send(message);
        };

        function onConnect() {
            console.log("Connected");
            client.subscribe("testtopic/999157");
        }
    </script>
</body>
</html> -->






<!DOCTYPE html>
<html>
<head>
    <title>MQTT Client</title>
</head>
<body>
    <h1>MQTT Client</h1>
    <button id="connect">Connect</button>
    <button id="publish">Publish</button>
    <input type="text" id="message" placeholder="Enter message">
    <div id="log"></div>
    <div id="mqttData"></div> <!-- ที่แสดงผลข้อมูลจาก MQTT -->

    <!-- โหลดไฟล์ Paho MQTT Client จาก CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.min.js"></script>
    <script>
        const client = new Paho.MQTT.Client("broker.hivemq.com", 8000, "1000");

        client.onConnectionLost = function (responseObject) {
            console.log("Connection lost: " + responseObject.errorMessage);
        };

        client.onMessageArrived = function (message) {
            console.log("Message arrived: " + message.payloadString);

            try {
                // แปลง JSON payload เป็นวัตถุ (object)
                const data = JSON.parse(message.payloadString);

                // เข้าถึงค่าต่างๆ ใน JSON
                const bpm = data.bpm;
                const steps = data.steps;

                // แสดงผลข้อมูลบนหน้าเว็บ
                document.getElementById("mqttData").innerHTML = 
                    `<p>BPM: ${bpm}</p><p>Steps: ${steps}</p>`;
            } catch (e) {
                console.error("Failed to parse JSON", e);
            }
        };

        document.getElementById("connect").onclick = function () {
            if (!client.isConnected()) {
                client.connect({
                    onSuccess: onConnect,
                    onFailure: onFailure,
                    useSSL: false
                });
            } else {
                console.log("Already connected to MQTT broker.");
                alert("Already connected to MQTT broker.");
            }
        };

        document.getElementById("publish").onclick = function () {
            if (client.isConnected()) {
                var message = new Paho.MQTT.Message(document.getElementById("message").value);
                message.destinationName = "testtopic/999157";
                client.send(message);
            } else {
                console.log("Not connected to MQTT broker.");
                alert("Not connected to MQTT broker.");
            }
        };

        function onConnect() {
            console.log("Connected");
            client.subscribe("testtopic/999157");
            console.log("Subscribed to topic: testtopic/999157");
        }

        function onFailure(message) {
            console.log("Connection failed: " + message.errorMessage);
            alert("Connection failed: " + message.errorMessage);
        }
    </script>
</body>
</html>
